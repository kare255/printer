<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø·Ø¨Ø§Ø¹Ø© Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø°ÙƒÙŠØ©</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; background: #f0f2f5; }
        .card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); max-width: 400px; margin: auto; }
        input { width: 90%; padding: 15px; margin: 10px 0; border: 2px solid #ddd; border-radius: 10px; font-size: 20px; text-align: center; }
        .btn-print { width: 100%; padding: 20px; background: #1a73e8; color: white; border: none; border-radius: 12px; font-size: 22px; font-weight: bold; cursor: pointer; }
        #barcodeImg { margin-top: 20px; max-width: 100%; display: none; border: 1px solid #eee; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
</head>
<body>

<div class="card">
    <h2>Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø³Ø±ÙŠØ¹</h2>
    <input type="number" id="pCode" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬ (5 Ø£Ø±Ù‚Ø§Ù…)">
    <input type="number" id="pWeight" placeholder="Ø§Ù„ÙˆØ²Ù† (5 Ø£Ø±Ù‚Ø§Ù…)">
    
    <button class="btn-print" onclick="prepareAndShare()">Ø·Ø¨Ø§Ø¹Ø© ÙÙˆØ±ÙŠØ© ğŸ–¨ï¸</button>
    
    <canvas id="canvas" style="display:none;"></canvas>
    <img id="barcodeImg">
</div>

<script>
    function prepareAndShare() {
        const code = document.getElementById('pCode').value.padStart(5, '0');
        const weight = document.getElementById('pWeight').value.padStart(5, '0');
        const fullBarcode = "21" + code + weight + "0";

        // 1. ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ÙƒØµÙˆØ±Ø© Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
        const canvas = document.getElementById('canvas');
        JsBarcode(canvas, fullBarcode, {
            format: "CODE128", displayValue: true, fontSize: 25, height: 80, width: 2
        });

        const imgDataUrl = canvas.toDataURL("image/png");
        const imgDisplay = document.getElementById('barcodeImg');
        imgDisplay.src = imgDataUrl;
        imgDisplay.style.display = "inline-block";

        // 2. Ù…Ø­Ø§ÙˆÙ„Ø© ÙØªØ­ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø£Ùˆ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
        // Ø¨Ù…Ø§ Ø£Ù† iPrint Ù…Ø«Ø¨ØªØŒ Ø³ÙŠØ¸Ù‡Ø± ÙÙŠ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ù†Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©
        fetch(imgDataUrl)
        .then(res => res.blob())
        .then(blob => {
            const file = new File([blob], "barcode.png", { type: "image/png" });
            if (navigator.canShare && navigator.canShare({ files: [file] })) {
                navigator.share({
                    files: [file],
                    title: 'Barcode',
                    text: fullBarcode
                })
                .catch(err => console.log("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©: ", err));
            } else {
                alert("Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ØŒ Ø¬Ø±Ø¨ Ù†Ø³Ø®Ø© Ø£Ø­Ø¯Ø« Ù…Ù† ÙƒØ±ÙˆÙ….");
            }
        });
    }
</script>
</body>
</html>
