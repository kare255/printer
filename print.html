<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø·Ø¨Ø§Ø¹Ø© ÙÙˆØ±ÙŠØ©</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 15px; border: 2px solid #007bff; max-width: 400px; margin: auto; }
        button { width: 100%; padding: 15px; margin: 10px 0; font-size: 18px; cursor: pointer; border-radius: 10px; border: none; font-weight: bold; }
        .btn-connect { background: #007bff; color: white; }
        .btn-print { background: #27ae60; color: white; }
        #status { color: #d35400; margin-bottom: 15px; }
    </style>
</head>
<body>
<div class="card">
    <h2>Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø°ÙƒÙŠ</h2>
    <p id="status">Ø§Ù„Ø­Ø§Ù„Ø©: Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±Ø¨Ø· ğŸ”Œ</p>
    <button class="btn-connect" onclick="connectAndPrint()">1. Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ù„Ø±Ø¨Ø· ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø© ğŸ–¨ï¸</button>
</div>

<script>
    async function connectAndPrint() {
        try {
            // 1. Ø·Ù„Ø¨ Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¹ ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„Ø¬Ù‡Ø§Ø² SC03h
            const device = await navigator.bluetooth.requestDevice({
                filters: [{ namePrefix: 'SC03' }],
                optionalServices: ['0000ae30-0000-1000-8000-00805f9b34fb']
            });

            document.getElementById('status').innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...";
            const server = await device.gatt.connect();
            const service = await server.getPrimaryService('0000ae30-0000-1000-8000-00805f9b34fb');
            const char = await service.getCharacteristic('0000ae01-0000-1000-8000-00805f9b34fb');

            document.getElementById('status').innerText = "Ù…ØªØµÙ„ âœ… Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

            // 2. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø¨Ù†Ø¸Ø§Ù… "Ø§Ù„Ù…ØµÙÙˆÙØ©" (Buffer) Ù„Ø¶Ù…Ø§Ù† ÙˆØµÙˆÙ„Ù‡Ø§ Ù„Ù„Ù…ÙˆØªÙˆØ±
            const encoder = new TextEncoder();
            const esc = new Uint8Array([0x1B, 0x40]); // Ø£Ù…Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„
            const feed = new Uint8Array([0x0A, 0x0A, 0x0A, 0x0A, 0x1D, 0x56, 0x42, 0x00]); // Ø£ÙˆØ§Ù…Ø± ØªØºØ°ÙŠØ© ÙˆØ±Ù‚ Ù…ÙƒØ«ÙØ©
            const text = encoder.encode("HELLO PRINTER\nREADY TO PRINT\n");

            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø·Ø¹Ø© Ù‚Ø·Ø¹Ø© (Chunking) Ù„ØªÙÙˆÙ‚ Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù€ 512 Ø¨Ø§ÙŠØª
            await char.writeValue(esc);
            await char.writeValue(text);
            await char.writeValue(feed);

            alert("ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„! Ø¥Ø°Ø§ Ù„Ù… ÙŠØ®Ø±Ø¬ ÙˆØ±Ù‚ØŒ ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ (GPS).");
            document.getElementById('status').innerText = "ØªÙ…Øª Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ğŸ";

        } catch (e) {
            alert("ÙØ´Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©: " + e);
            document.getElementById('status').innerText = "ÙØ´Ù„ âŒ";
        }
    }
</script>
</body>
</html>
