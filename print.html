<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø·Ø¨Ø§Ø¹Ø© Ù…ÙŠØ²Ø§Ù†</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; background: #f4f4f4; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); max-width: 400px; margin: auto; }
        input { width: 90%; padding: 15px; margin: 10px 0; border: 2px solid #ddd; border-radius: 8px; font-size: 20px; text-align: center; }
        button { width: 95%; padding: 15px; margin: 5px; border: none; border-radius: 8px; font-size: 18px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-connect { background: #007bff; color: white; }
        .btn-print { background: #27ae60; color: white; }
        #status { margin-top: 10px; color: #666; font-size: 14px; font-weight: bold; }
    </style><!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø±Ø©</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; background: #f4f4f4; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); max-width: 400px; margin: auto; }
        button { width: 95%; padding: 15px; margin: 10px 0; border: none; border-radius: 8px; font-size: 18px; cursor: pointer; font-weight: bold; }
        .btn-connect { background: #007bff; color: white; }
        .btn-test { background: #e74c3c; color: white; }
        #status { margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>

<div class="card">
    <h2>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© (ÙˆØ±Ù‚ Ù…Ø³ØªÙ…Ø±)</h2>
    <p id="status">Ø§Ù„Ø­Ø§Ù„Ø©: ØºÙŠØ± Ù…ØªØµÙ„ âŒ</p>
    <button class="btn-connect" onclick="connect()">1. Ø±Ø¨Ø· Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©</button>
    <button class="btn-test" onclick="forcePrint()">2. ØªØ¬Ø±Ø¨Ø© Ø·Ø¨Ø§Ø¹Ø© Ù†Øµ ğŸ–¨ï¸</button>
</div>

<script>
    let char = null;
    const S_UUID = '0000ae30-0000-1000-8000-00805f9b34fb'; 
    const C_UUID = '0000ae01-0000-1000-8000-00805f9b34fb'; 

    async function connect() {
        try {
            const device = await navigator.bluetooth.requestDevice({
                filters: [{ namePrefix: 'SC03h' }],
                optionalServices: [S_UUID]
            });
            const server = await device.gatt.connect();
            const service = await server.getPrimaryService(S_UUID);
            char = await service.getCharacteristic(C_UUID);
            document.getElementById('status').innerText = "Ù…ØªØµÙ„ âœ…";
            document.getElementById('status').style.color = "green";
        } catch (e) { alert("Ø®Ø·Ø£: " + e); }
    }

    async function forcePrint() {
        if (!char) return alert("Ø§Ø±Ø¨Ø· Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© Ø£ÙˆÙ„Ø§Ù‹!");

        const encoder = new TextEncoder();
        
        // Ø£ÙˆØ§Ù…Ø± Ø¨Ø³ÙŠØ·Ø© Ø¬Ø¯Ø§Ù‹: ØªÙ‡ÙŠØ¦Ø© + Ù†Øµ + Ø³Ø·ÙˆØ± ÙØ§Ø±ØºØ© ÙƒØ«ÙŠØ±Ø©
        const testData = [
            new Uint8Array([0x1B, 0x40]), // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© (Reset)
            encoder.encode("TEST PRINT\n"),
            encoder.encode("BARCODE SYSTEM OK\n"),
            new Uint8Array([0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A]) // 6 Ø£Ø³Ø·Ø± ÙØ§Ø±ØºØ© Ù„Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„ÙˆØ±Ù‚ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙˆØ¬
        ];

        try {
            for (let data of testData) {
                await char.writeValue(data);
            }
            alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª! Ø¥Ø°Ø§ Ù„Ù… ÙŠØ®Ø±Ø¬ ÙˆØ±Ù‚ØŒ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©.");
        } catch (e) { alert("Ø®Ø·Ø£ Ø·Ø¨Ø§Ø¹Ø©: " + e); }
    }
</script>
</body>
</html>

</head>
<body>

<div class="card">
    <h2>Ø·Ø¨Ø§Ø¹Ø© Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ù…ÙŠØ²Ø§Ù†</h2>
    <p id="status">Ø§Ù„Ø­Ø§Ù„Ø©: ØºÙŠØ± Ù…ØªØµÙ„ âŒ</p>
    <button class="btn-connect" onclick="connect()">1. Ø±Ø¨Ø· Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©</button>
    <hr>
    <input type="number" id="pCode" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬ (5 Ø£Ø±Ù‚Ø§Ù…)">
    <input type="number" id="pWeight" placeholder="Ø§Ù„ÙˆØ²Ù† (5 Ø£Ø±Ù‚Ø§Ù…)">
    <button class="btn-print" onclick="printLabel()">2. Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¢Ù† ğŸ–¨ï¸</button>
</div>

<script>
    let char = null;
    // Ø§Ù„Ù€ UUIDs Ø§Ù„Ù„ÙŠ Ø¸Ù‡Ø±Øª ÙÙŠ Ø§Ù„ØµÙˆØ± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø¬Ù‡Ø§Ø²Ùƒ
    const S_UUID = '0000ae30-0000-1000-8000-00805f9b34fb'; 
    const C_UUID = '0000ae01-0000-1000-8000-00805f9b34fb'; 

    async function connect() {
        try {
            const device = await navigator.bluetooth.requestDevice({
                filters: [{ namePrefix: 'SC03h' }],
                optionalServices: [S_UUID]
            });
            const server = await device.gatt.connect();
            const service = await server.getPrimaryService(S_UUID);
            char = await service.getCharacteristic(C_UUID);
            document.getElementById('status').innerText = "Ù…ØªØµÙ„ Ø¨Ù€ " + device.name + " âœ…";
            document.getElementById('status').style.color = "green";
        } catch (e) { alert("Ø®Ø·Ø£ Ø§ØªØµØ§Ù„: " + e); }
    }

    async function printLabel() {
        if (!char) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø±Ø¨Ø· Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© Ø£ÙˆÙ„Ø§Ù‹!");

        const code = document.getElementById('pCode').value.padStart(5, '0');
        const weight = document.getElementById('pWeight').value.padStart(5, '0');
        const barcodeData = "21" + code + weight + "0";

        // Ø£ÙˆØ§Ù…Ø± TSPL - Ù„ØºØ© Ø·Ø§Ø¨Ø¹Ø§Øª Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª Ø§Ù„ØµÙŠÙ†ÙŠØ© Ø§Ù„Ø£ØµÙ„ÙŠØ©
        const tspl = 
            "SIZE 40 mm, 30 mm\r\n" +  // ØªØ­Ø¯ÙŠØ¯ Ø­Ø¬Ù… Ø§Ù„Ù…Ù„ØµÙ‚ (Ø¹Ø¯Ù„Ù‡ Ø­Ø³Ø¨ ÙˆØ±Ù‚Ùƒ)
            "GAP 2 mm, 0 mm\r\n" +     // Ø§Ù„ÙØ§ØµÙ„ Ø¨ÙŠÙ† Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª
            "DIRECTION 1\r\n" +        // Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
            "CLS\r\n" +                // Ù…Ø³Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©
            "BARCODE 40,50,\"128\",80,1,0,2,2,\"" + barcodeData + "\"\r\n" + // Ø±Ø³Ù… Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
            "TEXT 40,140,\"3\",0,1,1,\"" + barcodeData + "\"\r\n" +           // Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ØªØ­ØªÙ‡
            "PRINT 1,1\r\n";           // Ø£Ù…Ø± Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ

        const encoder = new TextEncoder();
        try {
            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…Ø± ÙƒØ¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ù…
            await char.writeValue(encoder.encode(tspl));
            alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¨Ù†Ø¬Ø§Ø­!");
        } catch (e) { alert("Ø®Ø·Ø£ Ø·Ø¨Ø§Ø¹Ø©: " + e); }
    }
</script>
</body>
</html>
