<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø·Ø¨Ø§Ø¹Ø© Ù…ÙŠØ²Ø§Ù† Ø³Ø±ÙŠØ¹Ø©</title>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; background: #ffffff; }
        .container { border: 2px solid #2980b9; padding: 25px; border-radius: 20px; max-width: 350px; margin: auto; }
        input { width: 90%; padding: 15px; margin: 10px 0; font-size: 20px; border: 1px solid #ddd; border-radius: 10px; text-align: center; }
        .btn-print { width: 100%; padding: 20px; background: #2980b9; color: white; border: none; border-radius: 12px; font-size: 22px; font-weight: bold; cursor: pointer; }
        #barcodeImg { margin-top: 20px; width: 100%; display: none; }
    </style>
</head>
<body>

<div class="container">
    <h3>Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø°ÙƒÙŠ</h3>
    <input type="number" id="pCode" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬" oninput="gen()">
    <input type="number" id="pWeight" placeholder="Ø§Ù„ÙˆØ²Ù†" oninput="gen()">
    
    <button class="btn-print" onclick="printWithApp()">Ø·Ù€Ø¨Ù€Ø§Ø¹Ø© Ø§Ù„Ø¢Ù† ğŸ–¨ï¸</button>
    
    <div id="result">
        <img id="barcodeImg" src="">
    </div>
</div>

<canvas id="c" style="display:none;"></canvas>

<script>
    // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ÙÙˆØ± Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
    function gen() {
        const c = document.getElementById('pCode').value.padStart(5, '0');
        const w = document.getElementById('pWeight').value.padStart(5, '0');
        const val = "21" + c + w + "0";
        const canvas = document.getElementById('c');
        
        JsBarcode(canvas, val, {
            format: "CODE128",
            displayValue: true,
            fontSize: 25,
            height: 100,
            width: 3,
            margin: 10
        });

        const img = document.getElementById('barcodeImg');
        img.src = canvas.toDataURL("image/png");
        img.style.display = "inline-block";
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø¶ØºØ·Ø© ÙˆØ§Ø­Ø¯Ø©
    async function printWithApp() {
        const imgSource = document.getElementById('barcodeImg').src;
        if (!imgSource) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹");

        const blob = await (await fetch(imgSource)).blob();
        const file = new File([blob], "label.png", { type: "image/png" });

        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ù„ÙØªØ­ Bluetooth Print Ù…Ø¨Ø§Ø´Ø±Ø©
        if (navigator.share) {
            navigator.share({
                files: [file]
            }).then(() => {
                console.log('ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚');
            }).catch(console.error);
        } else {
            alert("ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØªØµÙØ­ Chrome");
        }
    }
</script>
</body>
</html>
